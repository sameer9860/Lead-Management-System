{% extends "base.html" %}
{% block content %}
{% block sidebar %}{% endblock %}

<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 to-gray-800 px-4 w-full">
  <div class="max-w-md w-full bg-gray-800 p-9 rounded-xl shadow-lg animate-fadeIn">
    <h2 class="text-center text-3xl font-semibold text-sky-400 mb-8">Login</h2>

    <div class="space-y-4 mb-6">
      {% for message in messages %}
      <div class="bg-red-700 text-red-100 rounded-md p-3 flex items-center space-x-2">
        <i class="fas fa-exclamation-triangle"></i>
        <span><strong>Error:</strong> {{ message }}</span>
      </div>
      {% endfor %}
    </div>

    <form method="post" class="space-y-6" novalidate>
      {% csrf_token %}

      <!-- Username -->
      <div>
        <label for="id_username" class="block mb-2 text-gray-300 font-medium">Username</label>
        <input type="text" name="username" id="id_username" required
               class="w-full rounded-lg bg-gray-900 border border-gray-700 text-gray-100 placeholder-gray-400 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-sky-400 transition" />
      </div>

      <!-- Password -->
      <div class="relative">
        <label for="id_password" class="block mb-2 text-gray-300 font-medium">Password</label>
        <input type="password" name="password" id="id_password" required
               class="w-full rounded-lg bg-gray-900 border border-gray-700 text-gray-100 placeholder-gray-400 px-4 py-3 pr-12 focus:outline-none focus:ring-2 focus:ring-sky-400 transition" />
        <span class="absolute right-3 top-[70%] -translate-y-1/2 cursor-pointer text-gray-400 select-none toggle-password" aria-label="Toggle password visibility" role="button" tabindex="0">
          <!-- Eye icon (hidden by default) -->
          <svg class="eye-icon hidden w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
          <!-- Eye slash icon (visible by default) -->
          <svg class="eye-slash-icon w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
            <line x1="1" y1="1" x2="23" y2="23"></line>
          </svg>
        </span>
      </div>

      <button type="submit" class="w-full bg-sky-500 hover:bg-sky-600 transition rounded-lg py-3 font-semibold text-white shadow-md">
        Login
      </button>
      <a href="{% url 'accounts:forget_password' %}" class="block text-sm text-center text-blue-400 hover:text-blue-200 transition">Forgot Password?</a>
    </form>
  </div>
</div>

<script>
    // Password toggle logic (your existing code)
    document.querySelector('.toggle-password').addEventListener('click', function() {
      const passwordInput = document.getElementById("id_password");
      const eyeIcon = this.querySelector(".eye-icon");
      const eyeSlashIcon = this.querySelector(".eye-slash-icon");
    
      if (passwordInput.type === "password") {
        passwordInput.type = "text";
        eyeSlashIcon.classList.add("hidden");
        eyeIcon.classList.remove("hidden");
      } else {
        passwordInput.type = "password";
        eyeIcon.classList.add("hidden");
        eyeSlashIcon.classList.remove("hidden");
      }
    });
    
    // Focus password input on Enter key in username input
    document.getElementById("id_username").addEventListener("keydown", function(event) {
      if (event.key === "Enter") {
        event.preventDefault(); // prevent form submit on Enter here
        document.getElementById("id_password").focus();
      }
    });

    //ajax for login
    document.getElementById("login-form").addEventListener("submit", function(e){
      e.preventDefault();
      let formData = new FormData(this);
  
      fetch("{% url 'accounts:login' %}", {
          method: "POST",
          headers: {"X-Requested-With": "XMLHttpRequest"},
          body: formData
      })
      .then(res => res.json())
      .then(data => {
          let msgDiv = document.getElementById("login-msg");
          if(data.success){
              msgDiv.innerHTML = `<p class="text-green-600">${data.redirect_url}</p>`;
              window.location.href = data.redirect_url;
          } else {
              msgDiv.innerHTML = `<p class="text-red-600">${JSON.stringify(data.errors)}</p>`;
          }
      });
  });
    
</script>

<style>
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-fadeIn {
    animation: fadeIn 0.8s ease-in-out forwards;
  }
</style>
{% endblock %}